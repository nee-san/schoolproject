# Description: The GNU Bourne Again shell
# URL:         http://www.gnu.org/software/bash/bash.html
# Maintainer:  nee-san, nagakamira at gmail dot com
# Depends on:  readline

name=bash
lbasever=5.0
patchlevel=003
stripped_lbasever="$(echo ${lbasever} | tr -d '.')"
version=${lbasever}.${patchlevel}
release=1
source=("http://ftp.gnu.org/gnu/$name/$name-$lbasever.tar.gz")
for patch in $(seq 1 ${patchlevel}); do
	source=(${source[@]} "http://ftp.gnu.org/gnu/bash/bash-${lbasever}-patches/bash${stripped_lbasever}-$(printf "%03d" ${patch})")
done
BOOTSTRAP=yes

build() {
	cd "$SRC"/$name-$lbasever

	for patch in $(seq 1 ${patchlevel}); do
		patch -p0 -i "$SRC/bash${stripped_lbasever}-$(printf "%03d" ${patch})"
	done

cat > config.cache << EOF
ac_cv_func_mmap_fixed_mapped=yes
ac_cv_func_strcoll_works=yes
ac_cv_func_working_mktime=yes
bash_cv_func_sigsetjmp=present
bash_cv_getcwd_malloc=yes
bash_cv_job_control_missing=present
bash_cv_printf_a_format=yes
bash_cv_sys_named_pipes=present
bash_cv_ulimit_maxfds=yes
bash_cv_under_sys_siglist=yes
bash_cv_unusable_rtsigs=no
gt_cv_int_divbyzero_sigfpe=yes
EOF

	./configure $BUILDFLAGS \
		--prefix=/usr \
		--with-curses \
		--without-bash-malloc \
		--enable-readline \
		--cache-file=config.cache
	make
	make DESTDIR="$PKG" install

	ln -sf bash "$PKG"/usr/bin/rbash
}
